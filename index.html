<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="windows-1252">  
  <title>CRM Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/crm_demo/css/style.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

<script>

$(document).ready(function(){
	refreshContacts();
	refreshOrganizations();	
});

function showError(strError) {
	alert(strError);
	return;
}

function refreshContacts() {

	$.ajax({
		url: "api/index.php?action=fetch_contacts", 
		success: function(result){
			refreshContacts_callback(result);
		}
	});

	return;
}

function refreshContacts_callback(data) {

	var objResponse = JSON.parse(data);
	
	if (objResponse['successful'] && 'false' == objResponse['successful']) {
		showError(objResponse['message']);
	}
	else {
		displayContacts(objResponse['contacts']);	
	}
	
	return;
}

function displayContacts(arrContacts) {

	var strHTML = '<form> \
					<input name="firstname" type="text" placeholder="First Name" required="required" /> \
					<input name="lastname" type="text" placeholder="Last Name" required="required" /> \
					<input name="email" type="email" placeholder="Email" required="required" /> \
					<input name="phone" type="tel" placeholder="Phone Number" required="required" /> \
					<button>Add</button> \
					</form> \
				  ';
	
	for (var x in arrContacts) {

		var iID = arrContacts[x]['id'];	
		var strFirstname = arrContacts[x]['firstname'];
		var strLastname = arrContacts[x]['lastname'];
		var strEmail = arrContacts[x]['email'];
		var strPhone = arrContacts[x]['phone'];

		strHTML += '<form data-id='+iID+'> \
					<span class="id">'+iID+'</span> \
					<input name="firstname" type="text" value="'+strFirstname+'" required="required" /> \
					<input name="lastname" type="text" value="'+strLastname+'" required="required" /> \
					<input name="email" type="email" value="'+strEmail+'" required="required" /> \
					<input name="phone" type="tel" value="'+strPhone+'" required="required" /> \
					<input type="button" value="Edit" onclick="updateContact($(this).parent());" /> \
					<input type="button" value="Del" onclick="deleteContact($(this).parent());" /> \
					</form> \
					';
					
	}
	
	var objContactDiv = document.getElementById('contactArea');
	objContactDiv.innerHTML = strHTML;
	
	return;
}

function refreshOrganizations() {

	$.ajax({
		url: "api/index.php?action=fetch_organizations", 
		success: function(result){
			refreshOrganizations_callback(result);
		}
	});
	
	return;
}

function refreshOrganizations_callback(data) {

	var objResponse = JSON.parse(data);
	
	if (objResponse['successful'] && 'false' == objResponse['successful']) {
		showError(objResponse['message']);
	}
	else {
		displayOrganizations(objResponse['organizations']);	
	}
	
	return;
}

function displayOrganizations(arrContacts) {

	var strHTML = '<form> \
					<input name="org_name" type="text" placeholder="Name" required="required" /> \
					<input name="website" type="text" placeholder="Website" required="required" /> \
					<button>Add</button> \
					</form> \
				  ';
	
	for (var x in arrContacts) {

		var iID = arrContacts[x]['id'];	
		var strOrgName = arrContacts[x]['org_name'];
		var strWebsite = arrContacts[x]['website'];

		strHTML += '<form data-id='+iID+'> \
					<span class="id">'+iID+'</span> \
					<input name="org_name" type="text" value="'+strOrgName+'" required="required" /> \
					<input name="website" type="text" value="'+strWebsite+'" required="required" /> \
					<input type="button" value="Edit" onclick="updateOrganization($(this).parent());" /> \
					<input type="button" value="Del" onclick="deleteOrganization($(this).parent());" /> \
					</form> \
					';
					
	}
	
	var objOrgDiv = document.getElementById('organizationArea');
	objOrgDiv.innerHTML = strHTML;
	
	return;
}

function updateContact(objForm) {

	var iId = $(objForm).data('id');
	var arrElements = $(objForm).children();
	
	var strFirstName = $(arrElements[1]).val();
	var strLastName = $(arrElements[2]).val();	
	var strEmail = $(arrElements[3]).val();	
	var strPhone = $(arrElements[4]).val();
	
	var strURL  = 'api/index.php?action=update_contact';
		strURL += '&contact_id='+iId;	
		strURL += '&firstname='+strFirstName;
		strURL += '&lastname='+strLastName;
		strURL += '&email='+strEmail;
		strURL += '&phone='+strPhone;
		
	console.info('CALL: '+strURL);
	
	$.ajax({
		url: strURL, 
		success: function(result){
			updateContacts_callback(result);
		}
	});	
	
	return;
}

function updateContacts_callback(data) {

	var objResponse = JSON.parse(data);
	
	if (objResponse['successful'] && 'false' == objResponse['successful']) {
		showError(objResponse['message']);
	}
	else {
		refreshContacts(objResponse['contacts']);	
	}

	return;
}

function updateOrganization(objForm) {

	var iId = $(objForm).data('id');
	var arrElements = $(objForm).children();
	
	var strOrgName = $(arrElements[1]).val();
	var strWebsite = $(arrElements[2]).val();	
	
	var strURL  = 'api/index.php?action=update_organization';
		strURL += '&org_id='+iId;	
		strURL += '&org_name='+strOrgName;
		strURL += '&website='+strWebsite;
		
	console.info('CALL: '+strURL);
	
	$.ajax({
		url: strURL, 
		success: function(result){
			updateOrganization_callback(result);
		}
	});

	return;
}

function updateOrganization_callback(data) {

	var objResponse = JSON.parse(data);
	
	if (objResponse['successful'] && 'false' == objResponse['successful']) {
		showError(objResponse['message']);
	}
	else {
		refreshOrganizations(objResponse['organizations']);	
	}

	return;
}

function deleteContact(objForm) {

	var iId = $(objForm).data('id');
	var arrElements = $(objForm).children();
	
	var strURL  = 'api/index.php?action=delete_contact';
		strURL += '&contact_id='+iId;	
		
	console.info('CALL: '+strURL);
	
	$.ajax({
		url: strURL, 
		success: function(result){
			deleteContact_callback(result);
		}
	});

	return;
}

function deleteContact_callback(data) {

	var objResponse = JSON.parse(data);
	
	if (objResponse['successful'] && 'false' == objResponse['successful']) {
		showError(objResponse['message']);
	}
	else {
		refreshContacts(objResponse['contacts']);	
	}
	
	return;
}

function deleteOrganization(objForm) {

	var iId = $(objForm).data('id');
	var arrElements = $(objForm).children();
	
	var strURL  = 'api/index.php?action=delete_organization';
		strURL += '&org_id='+iId;	
		
	console.info('CALL: '+strURL);
	
	$.ajax({
		url: strURL, 
		success: function(result){
			deleteOrganization_callback(result);
		}
	});

	return;
}

function deleteOrganization_callback(data) {

	var objResponse = JSON.parse(data);
	
	if (objResponse['successful'] && 'false' == objResponse['successful']) {
		showError(objResponse['message']);
	}
	else {
		refreshOrganizations(objResponse['organizations']);	
	}
	
	return;
}

</script>
  
  
</head>
<body>

<div id="header">
CRM Demo
</div>

<div id="content">

<br /><br />

<h2>Contacts</h2>

<div id="contactArea"></div>

<h2>Organizations</h2>

<div id="organizationArea"></div>


</div>

<div id="footer">
&copy; 2015-Present by Kevin Meixner
</div>


</body>
</html>